# Session State: Phase 3 - Remaining Proofs

**Branch:** `main`
**Last Updated:** 2026-01-27
**Status:** Ready to continue Phase 3 verification work

---

## Next Session: Remaining Proofs

### Phase 3 Progress (43% complete)

**Completed** (3/7):
1. ✅ Parser soundness proofs (`Parser/Properties.agda`, `Protocol/JSON/Properties.agda`)
2. ✅ LTL semantics proofs (`LTL/Bisimilarity.agda` - all 12 operators)
3. ✅ CAN encoding proofs (`Encoding.agda`, `Endianness.agda`, `Batch/Properties.agda`)

**Remaining** (4/7):
4. ⏸️ **DSL translation proofs** - Prove Python DSL → Agda translation preserves semantics
5. ⏸️ **Performance optimization** - Target: 1M frames/sec (currently ~10K)
6. ⏸️ **Parser memoization**
7. ⏸️ **Signal caching**

### Suggested Starting Point

**DSL translation proofs** would be the natural next step:
- Prove that the Python LTL DSL correctly translates to Agda LTL syntax
- Key files: `python/aletheia/dsl.py`, `src/Aletheia/LTL/JSON.agda`
- Goal: Show `dsl_to_json(expr)` produces JSON that `parseLTL` maps to equivalent Agda term

### Key Completed Proofs (Reference)

| Proof | File | Description |
|-------|------|-------------|
| `injectSignal-preserves-disjoint-bits` | `CAN/Encoding.agda:199-258` | Injection preserves disjoint bits |
| `injectAll-preserves-disjoint` | `CAN/Batch/Properties.agda` | Batch injection correctness |
| `extractBits-injectBits-roundtrip` | `CAN/Endianness.agda` | Bit-level roundtrip |
| `bisimilar-*` | `LTL/Bisimilarity.agda` | All 12 LTL operators |

---

## Development Environment

- **Agda binary**: `/home/nicolas/.cabal/bin/agda`
- **Shell**: `/usr/bin/fish`
- **Shell config**: Source `/home/nicolas/.config/fish/config.fish`
- **User binaries**: `/home/nicolas/.local/bin`
- **User libraries**: `/home/nicolas/.local/lib`

**Type-checking command**:
```bash
/home/nicolas/.cabal/bin/agda +RTS -N32 -RTS /home/nicolas/dev/agda/aletheia/src/Aletheia/YourModule.agda
```

---

## Recent Commits

- `84911e2` docs: Fix module counts and safety flag documentation
- `0e2d21c` fix(license): Correct license to BSD-2-Clause in cabal file
- `27138a7` feat(proofs): Complete batch operation correctness proofs

---

## Key Insight from Batch Proofs

> "Use plain with-patterns, avoid rewrite and in"

For proving lemmas about functions with nested `with`:
- Mirror the function's structure exactly with matching `with` patterns
- Don't use `rewrite` or `in` patterns - they interact badly with `with`
- Extract core proof logic into a helper that takes the derived equality
