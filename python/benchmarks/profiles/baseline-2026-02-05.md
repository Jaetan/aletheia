# Performance Baseline - 2026-02-05

## Summary

| Metric | Value | Target | Gap |
|--------|-------|--------|-----|
| Streaming throughput | 2,600 frames/sec | 1,000,000 frames/sec | 385x |
| Per-frame latency (p50) | 343 us | 1 us | 343x |
| Tail latency (p99.9) | 3,084 us | - | - |

## Throughput Results

```
Benchmark                              Mean      Stdev        Min        Max
----------------------------------------------------------------------
Streaming LTL (3 properties)        2,624/s        29     2,574     2,648
Signal Extraction                   2,364/s         8     2,353     2,374
Frame Building                      2,068/s        33     2,017     2,108
```

## Latency Distribution (microseconds)

```
Operation                    Mean        p50        p99      p99.9
----------------------------------------------------------------------
Streaming LTL               372.6      342.5      539.1     3083.8
Signal Extraction           412.2      383.2      583.2     2961.3
Frame Building              475.3      438.9     2602.4     3455.1
```

## Scaling Characteristics

### Trace Size Scaling (O(1) per frame - VERIFIED)

```
Frames      Frames/sec   Relative
---------------------------------
1,000           2,605       1.00x
5,000           3,005       1.15x
10,000          3,042       1.17x
50,000          3,074       1.18x
```

Throughput is constant or slightly improving with trace size (expected).

### Property Count Scaling

```
Properties   Frames/sec   Relative
----------------------------------
1                3,011       1.00x
2                2,661       0.88x
3                2,528       0.84x
5                2,237       0.74x
7                2,100       0.70x
10               1,849       0.61x
```

Sub-linear degradation with property count.

### Property Complexity

```
Complexity              Frames/sec   Relative
---------------------------------------------
Simple predicate            2,960       1.00x
Range predicate             2,996       1.01x
Two predicates              2,702       0.91x
Three predicates            2,591       0.88x
Implication                 3,014       1.02x
```

Property complexity has minimal impact.

## Analysis

### Bottleneck Identification (MEASURED)

Component breakdown measured using `component_breakdown.py`:

| Component | Time (us) | % of Total | Method |
|-----------|-----------|------------|--------|
| JSON serialization | 2.7 | 0.7% | json.dumps + json.loads |
| IPC overhead | 185.8 | 45.1% | echo_roundtrip - json_roundtrip |
| Agda processing | 223.5 | 54.2% | streaming_frame - echo_roundtrip |
| **Total** | 412.0 | 100% | End-to-end streaming frame |

**Conclusion**: Agda/MAlonzo processing is the primary bottleneck (54%), followed by IPC (45%). JSON is negligible.

### Optimization Strategies (Revised)

Based on measured data:

1. **Profile Agda/Haskell code** (54% of time) - GHC profiling to find hot spots
2. **Batch operations** - Amortize IPC cost over multiple frames
3. **Optimize MAlonzo output** - Check for inefficiencies in generated Haskell
4. **Reduce IPC overhead** - Binary protocol or shared memory (45% of time)

**Not worth optimizing**: JSON serialization (0.7%)

## Environment

- Platform: Linux 6.6.87.2-microsoft-standard-WSL2
- Python: 3.13
- Hardware: (WSL2 on Windows host)
